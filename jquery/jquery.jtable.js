(function($){var unloadingPage;$(window).on("beforeunload",(function(){unloadingPage=true}));$(window).on("unload",(function(){unloadingPage=false}));$.widget("hik.jtable",{options:{actions:{},fields:{},animationsEnabled:true,defaultDateFormat:"yy-mm-dd",defaultChangeMonth:false,defaultChangeYear:false,defaultYearRange:"c-10:c+10",defaultMaxDate:null,dialogShowEffect:"fade",dialogHideEffect:"fade",showCloseButton:false,loadingAnimationDelay:500,saveUserPreferences:true,jqueryuiTheme:false,unAuthorizedRequestRedirectUrl:null,ajaxSettings:{type:"POST",dataType:"json"},toolbar:{hoverAnimation:true,hoverAnimationDuration:60,hoverAnimationEasing:undefined,items:[]},closeRequested:function(event,data){},formCreated:function(event,data){},formSubmitting:function(event,data){},formClosed:function(event,data){},loadingRecords:function(event,data){},recordsLoaded:function(event,data){},rowInserted:function(event,data){},rowsRemoved:function(event,data){},messages:{serverCommunicationError:"An error occured while communicating to the server.",loadingMessage:"Loading records...",noDataAvailable:"No data available!",areYouSure:"Are you sure?",save:"Save",saving:"Saving",cancel:"Cancel",error:"Error",close:"Close",cannotLoadOptionsFor:"Can not load options for field {0}"}},_$mainContainer:null,_$titleDiv:null,_$toolbarDiv:null,_$table:null,_$tableBody:null,_$tableRows:null,_$busyDiv:null,_$busyMessageDiv:null,_$errorDialogDiv:null,_columnList:null,_fieldList:null,_keyField:null,_firstDataColumnOffset:0,_lastPostData:null,_cache:null,_extraFieldTypes:[],_create:function(){this._normalizeFieldsOptions();this._initializeFields();this._createFieldAndColumnList();this._createMainContainer();this._createTableTitle();this._createToolBar();this._createTable();this._createBusyPanel();this._createErrorDialogDiv();this._addNoDataRow();this._cookieKeyPrefix=this._generateCookieKeyPrefix()},_normalizeFieldsOptions:function(){var self=this;$.each(self.options.fields,(function(fieldName,props){self._normalizeFieldOptions(fieldName,props)}))},_normalizeFieldOptions:function(fieldName,props){if(props.listClass==undefined){props.listClass=""}if(props.inputClass==undefined){props.inputClass=""}if(props.placeholder==undefined){props.placeholder=""}if(props.dependsOn&&$.type(props.dependsOn)==="string"){var dependsOnArray=props.dependsOn.split(",");props.dependsOn=[];for(var i=0;i<dependsOnArray.length;i++){props.dependsOn.push($.trim(dependsOnArray[i]))}}},_initializeFields:function(){this._lastPostData={};this._$tableRows=[];this._columnList=[];this._fieldList=[];this._cache=[];this._extraFieldTypes=[]},_createFieldAndColumnList:function(){var self=this;$.each(self.options.fields,(function(name,props){self._fieldList.push(name);if(props.key==true){self._keyField=name}if(props.list!=false&&props.type!="hidden"){self._columnList.push(name)}}))},_createMainContainer:function(){this._$mainContainer=$("<div />").addClass("jtable-main-container").appendTo(this.element);this._jqueryuiThemeAddClass(this._$mainContainer,"ui-widget")},_createTableTitle:function(){var self=this;if(!self.options.title){return}var $titleDiv=$("<div />").addClass("jtable-title").appendTo(self._$mainContainer);self._jqueryuiThemeAddClass($titleDiv,"ui-widget-header");$("<div />").addClass("jtable-title-text").appendTo($titleDiv).append(self.options.title);if(self.options.showCloseButton){var $textSpan=$("<span />").html(self.options.messages.close);$("<button></button>").addClass("jtable-command-button jtable-close-button").attr("title",self.options.messages.close).append($textSpan).appendTo($titleDiv).click((function(e){e.preventDefault();e.stopPropagation();self._onCloseRequested()}))}self._$titleDiv=$titleDiv},_createTable:function(){this._$table=$("<table></table>").addClass("jtable").appendTo(this._$mainContainer);if(this.options.tableId){this._$table.attr("id",this.options.tableId)}this._jqueryuiThemeAddClass(this._$table,"ui-widget-content");this._createTableHead();this._createTableBody()},_createTableHead:function(){var $thead=$("<thead></thead>").appendTo(this._$table);this._addRowToTableHead($thead)},_addRowToTableHead:function($thead){var $tr=$("<tr></tr>").appendTo($thead);this._addColumnsToHeaderRow($tr)},_addColumnsToHeaderRow:function($tr){for(var i=0;i<this._columnList.length;i++){var fieldName=this._columnList[i];var $headerCell=this._createHeaderCellForField(fieldName,this.options.fields[fieldName]);$headerCell.appendTo($tr)}},_createHeaderCellForField:function(fieldName,field){field.width=field.width||"10%";var $headerTextSpan=$("<span />").addClass("jtable-column-header-text").html(field.title);var $headerContainerDiv=$("<div />").addClass("jtable-column-header-container").append($headerTextSpan);var $th=$("<th></th>").addClass("jtable-column-header").addClass(field.listClass).css("width",field.width).data("fieldName",fieldName).append($headerContainerDiv);this._jqueryuiThemeAddClass($th,"ui-state-default");return $th},_createEmptyCommandHeader:function(){var $th=$("<th></th>").addClass("jtable-command-column-header").css("width","1%");this._jqueryuiThemeAddClass($th,"ui-state-default");return $th},_createTableBody:function(){this._$tableBody=$("<tbody></tbody>").appendTo(this._$table)},_createBusyPanel:function(){this._$busyMessageDiv=$("<div />").addClass("jtable-busy-message").prependTo(this._$mainContainer);this._$busyDiv=$("<div />").addClass("jtable-busy-panel-background").prependTo(this._$mainContainer);this._jqueryuiThemeAddClass(this._$busyMessageDiv,"ui-widget-header");this._hideBusy()},_createErrorDialogDiv:function(){var self=this;self._$errorDialogDiv=$("<div></div>").appendTo(self._$mainContainer);self._$errorDialogDiv.dialog({autoOpen:false,show:self.options.dialogShowEffect,hide:self.options.dialogHideEffect,modal:true,title:self.options.messages.error,buttons:[{text:self.options.messages.close,click:function(){self._$errorDialogDiv.dialog("close")}}]})},load:function(postData,completeCallback){this._lastPostData=postData;this._reloadTable(completeCallback)},reload:function(completeCallback){this._reloadTable(completeCallback)},getRowByKey:function(key){for(var i=0;i<this._$tableRows.length;i++){if(key==this._getKeyValueOfRecord(this._$tableRows[i].data("record"))){return this._$tableRows[i]}}return null},destroy:function(){this.element.empty();$.Widget.prototype.destroy.call(this)},_setOption:function(key,value){},_reloadTable:function(completeCallback){var self=this;var completeReload=function(data){self._hideBusy();if(data.Result!="OK"){self._showError(data.Message);return}self._removeAllRows("reloading");self._addRecordsToTable(data.Records);self._onRecordsLoaded(data);if(completeCallback){completeCallback()}};self._showBusy(self.options.messages.loadingMessage,self.options.loadingAnimationDelay);self._onLoadingRecords();if($.isFunction(self.options.actions.listAction)){var funcResult=self.options.actions.listAction(self._lastPostData,self._createJtParamsForLoading());if(self._isDeferredObject(funcResult)){funcResult.done((function(data){completeReload(data)})).fail((function(){self._showError(self.options.messages.serverCommunicationError)})).always((function(){self._hideBusy()}))}else{completeReload(funcResult)}}else{var loadUrl=self._createRecordLoadUrl();self._ajax({url:loadUrl,data:self._lastPostData,success:function(data){completeReload(data)},error:function(){self._hideBusy();self._showError(self.options.messages.serverCommunicationError)}})}},_createRecordLoadUrl:function(){return this.options.actions.listAction},_createJtParamsForLoading:function(){return{}},_createRowFromRecord:function(record){var $tr=$("<tr></tr>").addClass("jtable-data-row").attr("data-record-key",this._getKeyValueOfRecord(record)).data("record",record);this._addCellsToRowUsingRecord($tr);return $tr},_addCellsToRowUsingRecord:function($row){var record=$row.data("record");for(var i=0;i<this._columnList.length;i++){this._createCellForRecordField(record,this._columnList[i]).appendTo($row)}},_createCellForRecordField:function(record,fieldName){return $("<td></td>").addClass(this.options.fields[fieldName].listClass).append(this._getDisplayTextForRecordField(record,fieldName))},_addRecordsToTable:function(records){var self=this;$.each(records,(function(index,record){self._addRow(self._createRowFromRecord(record))}));self._refreshRowStyles()},_addRowToTable:function($tableRow,index,isNewRow,animationsEnabled){var options={index:this._normalizeNumber(index,0,this._$tableRows.length,this._$tableRows.length)};if(isNewRow==true){options.isNewRow=true}if(animationsEnabled==false){options.animationsEnabled=false}this._addRow($tableRow,options)},_addRow:function($row,options){options=$.extend({index:this._$tableRows.length,isNewRow:false,animationsEnabled:true},options);if(this._$tableRows.length<=0){this._removeNoDataRow()}options.index=this._normalizeNumber(options.index,0,this._$tableRows.length,this._$tableRows.length);if(options.index==this._$tableRows.length){this._$tableBody.append($row);this._$tableRows.push($row)}else if(options.index==0){this._$tableBody.prepend($row);this._$tableRows.unshift($row)}else{this._$tableRows[options.index-1].after($row);this._$tableRows.splice(options.index,0,$row)}this._onRowInserted($row,options.isNewRow);if(options.isNewRow){this._refreshRowStyles();if(this.options.animationsEnabled&&options.animationsEnabled){this._showNewRowAnimation($row)}}},_showNewRowAnimation:function($tableRow){var className="jtable-row-created";if(this.options.jqueryuiTheme){className=className+" ui-state-highlight"}$tableRow.addClass(className,"slow","",(function(){$tableRow.removeClass(className,5e3)}))},_removeRowsFromTable:function($rows,reason){var self=this;if($rows.length<=0){return}$rows.addClass("jtable-row-removed").remove();$rows.each((function(){var index=self._findRowIndex($(this));if(index>=0){self._$tableRows.splice(index,1)}}));self._onRowsRemoved($rows,reason);if(self._$tableRows.length==0){self._addNoDataRow()}self._refreshRowStyles()},_findRowIndex:function($row){return this._findIndexInArray($row,this._$tableRows,(function($row1,$row2){return $row1.data("record")==$row2.data("record")}))},_removeAllRows:function(reason){if(this._$tableRows.length<=0){return}var $rows=this._$tableBody.find("tr.jtable-data-row");this._$tableBody.empty();this._$tableRows=[];this._onRowsRemoved($rows,reason);this._addNoDataRow()},_addNoDataRow:function(){if(this._$tableBody.find(">tr.jtable-no-data-row").length>0){return}var $tr=$("<tr></tr>").addClass("jtable-no-data-row").appendTo(this._$tableBody);var totalColumnCount=this._$table.find("thead th").length;$("<td></td>").attr("colspan",totalColumnCount).html(this.options.messages.noDataAvailable).appendTo($tr)},_removeNoDataRow:function(){this._$tableBody.find(".jtable-no-data-row").remove()},_refreshRowStyles:function(){for(var i=0;i<this._$tableRows.length;i++){if(i%2==0){this._$tableRows[i].addClass("jtable-row-even")}else{this._$tableRows[i].removeClass("jtable-row-even")}}},_getDisplayTextForRecordField:function(record,fieldName){var field=this.options.fields[fieldName];var fieldValue=record[fieldName];if(field.display){return field.display({record:record})}var extraFieldType=this._findItemByProperty(this._extraFieldTypes,"type",field.type);if(extraFieldType&&extraFieldType.creator){return extraFieldType.creator(record,field)}else if(field.type=="date"){return this._getDisplayTextForDateRecordField(field,fieldValue)}else if(field.type=="checkbox"){return this._getCheckBoxTextForFieldByValue(fieldName,fieldValue)}else if(field.options){var options=this._getOptionsForField(fieldName,{record:record,value:fieldValue,source:"list",dependedValues:this._createDependedValuesUsingRecord(record,field.dependsOn)});return this._findOptionByValue(options,fieldValue).DisplayText}else{return fieldValue}},_createDependedValuesUsingRecord:function(record,dependsOn){if(!dependsOn){return{}}var dependedValues={};for(var i=0;i<dependsOn.length;i++){dependedValues[dependsOn[i]]=record[dependsOn[i]]}return dependedValues},_findOptionByValue:function(options,value){return this._findItemByProperty(options,"Value",value)},_findItemByProperty:function(items,key,value){for(var i=0;i<items.length;i++){if(items[i][key]==value){return items[i]}}return{}},_getDisplayTextForDateRecordField:function(field,fieldValue){if(!fieldValue){return""}var displayFormat=field.displayFormat||this.options.defaultDateFormat;var date=this._parseDate(fieldValue);try{return this._formatDate(displayFormat,date)}catch(e){return date}},_formatDate:function(format,date){var pad=function(n,width,z){z=z||"0";n=n+"";return n.length>=width?n:new Array(width-n.length+1).join(z)+n};format=format.replace("ss",pad(date.getSeconds(),2));format=format.replace("s",date.getSeconds());format=format.replace("dd",pad(date.getDate(),2));format=format.replace("d",date.getDate());format=format.replace("mm",pad(date.getMinutes(),2));format=format.replace("m",date.getMinutes());format=format.replace("MM",pad(date.getMonth()+1,2));format=format.replace(/M(?![ao])/,date.getMonth()+1);format=format.replace("yyyy",date.getFullYear());format=format.replace("YYYY",date.getFullYear());format=format.replace("yy",(date.getFullYear()+"").substring(2));format=format.replace("YY",(date.getFullYear()+"").substring(2));format=format.replace("HH",pad(date.getHours(),2));format=format.replace("H",date.getHours());format=format.replace("hh",pad(date.getHours(),2));format=format.replace("h",date.getHours());return format},_getOptionsForField:function(fieldName,funcParams){var field=this.options.fields[fieldName];var optionsSource=field.options;if($.isFunction(optionsSource)){funcParams=$.extend(true,{_cacheCleared:false,dependedValues:{},clearCache:function(){this._cacheCleared=true}},funcParams);optionsSource=optionsSource(funcParams)}var options;if(typeof optionsSource=="string"){var cacheKey="options_"+fieldName+"_"+optionsSource;if(funcParams._cacheCleared||!this._cache[cacheKey]){this._cache[cacheKey]=this._buildOptionsFromArray(this._downloadOptions(fieldName,optionsSource));this._sortFieldOptions(this._cache[cacheKey],field.optionsSorting)}else{if(funcParams.value!=undefined){var optionForValue=this._findOptionByValue(this._cache[cacheKey],funcParams.value);if(optionForValue.DisplayText==undefined){this._cache[cacheKey]=this._buildOptionsFromArray(this._downloadOptions(fieldName,optionsSource));this._sortFieldOptions(this._cache[cacheKey],field.optionsSorting)}}}options=this._cache[cacheKey]}else if(jQuery.isArray(optionsSource)){options=this._buildOptionsFromArray(optionsSource);this._sortFieldOptions(options,field.optionsSorting)}else{options=this._buildOptionsArrayFromObject(optionsSource);this._sortFieldOptions(options,field.optionsSorting)}return options},_downloadOptions:function(fieldName,url){var self=this;var options=[];self._ajax({url:url,async:false,success:function(data){if(data.Result!="OK"){self._showError(data.Message);return}options=data.Options},error:function(){var errMessage=self._formatString(self.options.messages.cannotLoadOptionsFor,fieldName);self._showError(errMessage)}});return options},_sortFieldOptions:function(options,sorting){if(!options||!options.length||!sorting){return}var dataSelector;if(sorting.indexOf("value")==0){dataSelector=function(option){return option.Value}}else{dataSelector=function(option){return option.DisplayText}}var compareFunc;if($.type(dataSelector(options[0]))=="string"){compareFunc=function(option1,option2){return dataSelector(option1).localeCompare(dataSelector(option2))}}else{compareFunc=function(option1,option2){return dataSelector(option1)-dataSelector(option2)}}if(sorting.indexOf("desc")>0){options.sort((function(a,b){return compareFunc(b,a)}))}else{options.sort((function(a,b){return compareFunc(a,b)}))}},_buildOptionsArrayFromObject:function(options){var list=[];$.each(options,(function(propName,propValue){list.push({Value:propName,DisplayText:propValue})}));return list},_buildOptionsFromArray:function(optionsArray){var list=[];for(var i=0;i<optionsArray.length;i++){if($.isPlainObject(optionsArray[i])){list.push(optionsArray[i])}else{list.push({Value:optionsArray[i],DisplayText:optionsArray[i]})}}return list},_parseDate:function(dateString){try{if(dateString.indexOf("Date")>=0){return new Date(parseInt(dateString.substr(6),10))}else if(dateString.length==10){return new Date(parseInt(dateString.substr(0,4),10),parseInt(dateString.substr(5,2),10)-1,parseInt(dateString.substr(8,2),10))}else if(dateString.length==19){return new Date(parseInt(dateString.substr(0,4),10),parseInt(dateString.substr(5,2),10)-1,parseInt(dateString.substr(8,2),10),parseInt(dateString.substr(11,2),10),parseInt(dateString.substr(14,2),10),parseInt(dateString.substr(17,2),10))}else if(dateString.indexOf("T")>0){var dtstr=dateString.replace(/\D/g," ");var dtcomps=dtstr.split(" ");dtcomps[1]--;return new Date(Date.UTC(dtcomps[0],dtcomps[1],dtcomps[2],dtcomps[3],dtcomps[4],dtcomps[5]))}else{throw"Given date is not properly formatted: "+dateString}}catch(e){this._logWarn(e);return"format error!"}},_createToolBar:function(){this._$toolbarDiv=$("<div />").addClass("jtable-toolbar").appendTo(this._$titleDiv);for(var i=0;i<this.options.toolbar.items.length;i++){this._addToolBarItem(this.options.toolbar.items[i])}},_addToolBarItem:function(item){if(item==undefined||item.text==undefined&&item.icon==undefined){this._logWarn("Can not add tool bar item since it is not valid!");this._logWarn(item);return null}var $toolBarItem=$("<span></span>").addClass("jtable-toolbar-item").appendTo(this._$toolbarDiv);this._jqueryuiThemeAddClass($toolBarItem,"ui-widget ui-state-default ui-corner-all","ui-state-hover");if(item.cssClass){$toolBarItem.addClass(item.cssClass)}if(item.tooltip){$toolBarItem.attr("title",item.tooltip)}if(item.icon){var $icon=$('<span class="jtable-toolbar-item-icon"></span>').appendTo($toolBarItem);if(item.icon===true){}else if($.type(item.icon==="string")){$icon.css("background",'url("'+item.icon+'")')}}if(item.text){$('<span class=""></span>').html(item.text).addClass("jtable-toolbar-item-text").appendTo($toolBarItem)}if(item.click){$toolBarItem.click((function(){item.click()}))}var hoverAnimationDuration=undefined;var hoverAnimationEasing=undefined;if(this.options.toolbar.hoverAnimation){hoverAnimationDuration=this.options.toolbar.hoverAnimationDuration;hoverAnimationEasing=this.options.toolbar.hoverAnimationEasing}$toolBarItem.hover((function(){$toolBarItem.addClass("jtable-toolbar-item-hover",hoverAnimationDuration,hoverAnimationEasing)}),(function(){$toolBarItem.removeClass("jtable-toolbar-item-hover",hoverAnimationDuration,hoverAnimationEasing)}));return $toolBarItem},_showError:function(message){this._$errorDialogDiv.html(message).dialog("open")},_setBusyTimer:null,_showBusy:function(message,delay){var self=this;self._$busyDiv.width(self._$mainContainer.width()).height(self._$mainContainer.height()).addClass("jtable-busy-panel-background-invisible").show();var makeVisible=function(){self._$busyDiv.removeClass("jtable-busy-panel-background-invisible");self._$busyMessageDiv.html(message).show()};if(delay){if(self._setBusyTimer){return}self._setBusyTimer=setTimeout(makeVisible,delay)}else{makeVisible()}},_hideBusy:function(){clearTimeout(this._setBusyTimer);this._setBusyTimer=null;this._$busyDiv.hide();this._$busyMessageDiv.html("").hide()},_isBusy:function(){return this._$busyMessageDiv.is(":visible")},_jqueryuiThemeAddClass:function($elm,className,hoverClassName){if(!this.options.jqueryuiTheme){return}$elm.addClass(className);if(hoverClassName){$elm.hover((function(){$elm.addClass(hoverClassName)}),(function(){$elm.removeClass(hoverClassName)}))}},_performAjaxCall:function(url,postData,async,success,error){this._ajax({url:url,data:postData,async:async,success:success,error:error})},_unAuthorizedRequestHandler:function(){if(this.options.unAuthorizedRequestRedirectUrl){location.href=this.options.unAuthorizedRequestRedirectUrl}else{location.reload(true)}},_ajax:function(options){var self=this;var opts={statusCode:{401:function(){self._unAuthorizedRequestHandler()}}};opts=$.extend(opts,this.options.ajaxSettings,options);opts.success=function(data){if(data&&data.UnAuthorizedRequest==true){self._unAuthorizedRequestHandler()}if(options.success){options.success(data)}};opts.error=function(jqXHR,textStatus,errorThrown){if(unloadingPage){jqXHR.abort();return}if(options.error){options.error(arguments)}};opts.complete=function(){if(options.complete){options.complete()}};$.ajax(opts)},_getKeyValueOfRecord:function(record){return record[this._keyField]},_setCookie:function(key,value){key=this._cookieKeyPrefix+key;var expireDate=new Date;expireDate.setDate(expireDate.getDate()+30);document.cookie=encodeURIComponent(key)+"="+encodeURIComponent(value)+"; expires="+expireDate.toUTCString()},_getCookie:function(key){key=this._cookieKeyPrefix+key;var equalities=document.cookie.split("; ");for(var i=0;i<equalities.length;i++){if(!equalities[i]){continue}var splitted=equalities[i].split("=");if(splitted.length!=2){continue}if(decodeURIComponent(splitted[0])===key){return decodeURIComponent(splitted[1]||"")}}return null},_generateCookieKeyPrefix:function(){var simpleHash=function(value){var hash=0;if(value.length==0){return hash}for(var i=0;i<value.length;i++){var ch=value.charCodeAt(i);hash=(hash<<5)-hash+ch;hash=hash&hash}return hash};var strToHash="";if(this.options.tableId){strToHash=strToHash+this.options.tableId+"#"}strToHash=strToHash+this._columnList.join("$")+"#c"+this._$table.find("thead th").length;return"jtable#"+simpleHash(strToHash)},_onLoadingRecords:function(){this._trigger("loadingRecords",null,{})},_onRecordsLoaded:function(data){this._trigger("recordsLoaded",null,{records:data.Records,serverResponse:data})},_onRowInserted:function($row,isNewRow){this._trigger("rowInserted",null,{row:$row,record:$row.data("record"),isNewRow:isNewRow})},_onRowsRemoved:function($rows,reason){this._trigger("rowsRemoved",null,{rows:$rows,reason:reason})},_onCloseRequested:function(){this._trigger("closeRequested",null,{})}})})(jQuery);(function($){$.extend(true,$.hik.jtable.prototype,{_getPropertyOfObject:function(obj,propName){if(propName.indexOf(".")<0){return obj[propName]}else{var preDot=propName.substring(0,propName.indexOf("."));var postDot=propName.substring(propName.indexOf(".")+1);return this._getPropertyOfObject(obj[preDot],postDot)}},_setPropertyOfObject:function(obj,propName,value){if(propName.indexOf(".")<0){obj[propName]=value}else{var preDot=propName.substring(0,propName.indexOf("."));var postDot=propName.substring(propName.indexOf(".")+1);this._setPropertyOfObject(obj[preDot],postDot,value)}},_insertToArrayIfDoesNotExists:function(array,value){if($.inArray(value,array)<0){array.push(value)}},_findIndexInArray:function(value,array,compareFunc){if(!compareFunc){compareFunc=function(a,b){return a==b}}for(var i=0;i<array.length;i++){if(compareFunc(value,array[i])){return i}}return-1},_normalizeNumber:function(number,min,max,defaultValue){if(number==undefined||number==null||isNaN(number)){return defaultValue}if(number<min){return min}if(number>max){return max}return number},_formatString:function(){if(arguments.length==0){return null}var str=arguments[0];for(var i=1;i<arguments.length;i++){var placeHolder="{"+(i-1)+"}";str=str.replace(placeHolder,arguments[i])}return str},_isDeferredObject:function(obj){return obj.then&&obj.done&&obj.fail},_logDebug:function(text){if(!window.console){return}console.log("jTable DEBUG: "+text)},_logInfo:function(text){if(!window.console){return}console.log("jTable INFO: "+text)},_logWarn:function(text){if(!window.console){return}console.log("jTable WARNING: "+text)},_logError:function(text){if(!window.console){return}console.log("jTable ERROR: "+text)}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)return from}return-1}}})(jQuery);(function($){var base={_initializeFields:$.hik.jtable.prototype._initializeFields,_normalizeFieldOptions:$.hik.jtable.prototype._normalizeFieldOptions,_createHeaderCellForField:$.hik.jtable.prototype._createHeaderCellForField,_createRecordLoadUrl:$.hik.jtable.prototype._createRecordLoadUrl,_createJtParamsForLoading:$.hik.jtable.prototype._createJtParamsForLoading};$.extend(true,$.hik.jtable.prototype,{options:{sorting:false,multiSorting:false,defaultSorting:""},_lastSorting:null,_initializeFields:function(){base._initializeFields.apply(this,arguments);this._lastSorting=[];if(this.options.sorting){this._buildDefaultSortingArray()}},_normalizeFieldOptions:function(fieldName,props){base._normalizeFieldOptions.apply(this,arguments);props.sorting=props.sorting!=false},_createHeaderCellForField:function(fieldName,field){var $headerCell=base._createHeaderCellForField.apply(this,arguments);if(this.options.sorting&&field.sorting){this._makeColumnSortable($headerCell,fieldName,field.initialSortingDirection)}return $headerCell},_createRecordLoadUrl:function(){var loadUrl=base._createRecordLoadUrl.apply(this,arguments);loadUrl=this._addSortingInfoToUrl(loadUrl);return loadUrl},_buildDefaultSortingArray:function(){var self=this;$.each(self.options.defaultSorting.split(","),(function(orderIndex,orderValue){$.each(self.options.fields,(function(fieldName,fieldProps){if(fieldProps.sorting){var colOffset=orderValue.indexOf(fieldName);if(colOffset>-1){if(orderValue.toUpperCase().indexOf(" DESC",colOffset)>-1){self._lastSorting.push({fieldName:fieldName,sortOrder:"DESC"})}else{self._lastSorting.push({fieldName:fieldName,sortOrder:"ASC"})}}}}))}))},_makeColumnSortable:function($columnHeader,fieldName,initialSortingDirection){var self=this;$columnHeader.addClass("jtable-column-header-sortable").click((function(e){e.preventDefault();if(!self.options.multiSorting||!e.ctrlKey){self._lastSorting=[]}self._sortTableByColumn($columnHeader)}));if(initialSortingDirection){$columnHeader.addClass("jtable-column-header-sorted-"+initialSortingDirection.toLowerCase())}$.each(this._lastSorting,(function(sortIndex,sortField){if(sortField.fieldName==fieldName){if(sortField.sortOrder=="DESC"){$columnHeader.addClass("jtable-column-header-sorted-desc")}else{$columnHeader.addClass("jtable-column-header-sorted-asc")}}}))},_sortTableByColumn:function($columnHeader){if(this._lastSorting.length==0){$columnHeader.siblings().removeClass("jtable-column-header-sorted-asc jtable-column-header-sorted-desc")}for(var i=0;i<this._lastSorting.length;i++){if(this._lastSorting[i].fieldName==$columnHeader.data("fieldName")){this._lastSorting.splice(i--,1)}}if($columnHeader.hasClass("jtable-column-header-sorted-asc")){$columnHeader.removeClass("jtable-column-header-sorted-asc").addClass("jtable-column-header-sorted-desc");this._lastSorting.push({fieldName:$columnHeader.data("fieldName"),sortOrder:"DESC"})}else{$columnHeader.removeClass("jtable-column-header-sorted-desc").addClass("jtable-column-header-sorted-asc");this._lastSorting.push({fieldName:$columnHeader.data("fieldName"),sortOrder:"ASC"})}this._reloadTable()},_addSortingInfoToUrl:function(url){if(!this.options.sorting||this._lastSorting.length==0){return url}var sorting=[];$.each(this._lastSorting,(function(idx,value){sorting.push(value.fieldName+" "+value.sortOrder)}));return url+(url.indexOf("?")<0?"?":"&")+"jtSorting="+sorting.join(",")},_createJtParamsForLoading:function(){var jtParams=base._createJtParamsForLoading.apply(this,arguments);if(this.options.sorting&&this._lastSorting.length){var sorting=[];$.each(this._lastSorting,(function(idx,value){sorting.push(value.fieldName+" "+value.sortOrder)}));jtParams.jtSorting=sorting.join(",")}return jtParams}})})(jQuery);
