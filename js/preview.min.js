/*!
 * Detail Preview for PHPMaker v2025.0.0
 * Copyright (c) e.World Technology Limited. All rights reserved.
 */
!function(e,t){"use strict";t.PREVIEW=!0,t.PREVIEW_TEMPLATE='<div class="ew-nav ew-preview-nav">\x3c!-- .ew-preview-nav --\x3e\n    <ul class="nav nav-'+t.PREVIEW_NAV_STYLE+'" role="tablist"></ul>\n    <div class="tab-content">\x3c!-- .tab-content --\x3e\n        <div class="tab-pane fade" role="tabpanel"></div>\n    </div>\x3c!-- /.tab-content --\x3e\n</div>\x3c!-- /.ew-preview-nav --\x3e',t.PREVIEW_LOADING_HTML=t.spinnerTemplate(),t.PREVIEW_MODAL_HTML='<div id="ew-preview-dialog" class="ew-preview-container '+t.PREVIEW_MODAL_CLASS+'" role="dialog" aria-hidden="true"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">'+t.language.phrase("CloseBtn")+"</button></div></div></div></div>",t.PREVIEW_MODAL_OPTIONS={},t.PREVIEW_MODAL_DIALOG=null,t.PREVIEW_OFFCANVAS_HTML='<div id="ew-preview-offcanvas" class="ew-preview-container offcanvas offcanvas-'+t.PREVIEW_OFFCANVAS_PLACEMENT+'" data-bs-scroll="true" tabindex="-1" aria-labelledby="ew-preview-offcanvas-label"><div class="offcanvas-header"><h5 id="ew-preview-offcanvas-label">'+t.language.phrase("Details")+'</h5><button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"></div></div>',t.PREVIEW_OFFCANVAS_OPTIONS={},t.PREVIEW_OFFCANVAS_SIDEBAR=null;const a=e(document);let n=a=>{let n=e(a.currentTarget).closest("tr"),o=n.is("tr[data-rowindex]")?n:n.closest("tr[data-rowindex]"),d=o.find("[class$=_preview] .ew-preview"),s=o.closest("table");if(o[0]&&d[0]){if("true"===o.attr("aria-expanded")){let a=function(a){let n,o=e(a),d=o.closest("tbody");t.PREVIEW_SINGLE_ROW&&(d.find("tr.ew-table-preview-row").remove(),d.find("tr[aria-expanded]").not(a).attr("aria-expanded","false"));let s=Array.from(a.cells).reduce(((e,t)=>e+t.colSpan),0),i=o.nextAll("tr[data-rowindex!="+o.data("rowindex")+"]").first();return i.hasClass("ew-table-preview-row")?i[0]:((n=d[0].insertRow(i[0]?i[0].sectionRowIndex:-1))&&(e(n).addClass("ew-preview-container ew-table-preview-row expandable-body"),e(n.insertCell(0)).addClass("ew-table-last-col").prop("colSpan",s)),n)}(o[0]),n=e(a.cells[0]),s="target"+t.random();n.empty(),n.append(t.PREVIEW_TEMPLATE),n.children().slideUp(0),n.find(".nav-tabs, .nav-pills, .nav-underline").append(d.find(".nav-item").clone(!0)),n.find(".tab-pane").attr("id",s),n.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+s,"aria-controls":s}).first().tab("show"),n.children().slideDown(500)}t.setupTable(s[0],!0)}},o=function(a,n){var o;if(bootstrap.Popover.getInstance(n))return;let d=e(n.closest(".ew-list-option-body, .ew-multi-column-list-option-table, .ew-multi-column-list-option-card"));if(null==(o=bootstrap.Tooltip.getInstance(n))||o.dispose(),!(n=n.closest(t.PREVIEW_SELECTOR)))return;n.classList.contains("ew-preview-btn")||n.classList.add("ew-preview-btn");let s=new bootstrap.Popover(n,{...t.popoverOptions,delay:t.PREVIEW_POPOVER_DELAY,placement:t.PREVIEW_POPOVER_PLACEMENT,container:document.getElementById("ew-tooltip"),content:t.PREVIEW_LOADING_HTML,customClass:"ew-preview-container ew-preview-popover",trigger:"click"==t.PREVIEW_POPOVER_TRIGGER?"click":"manual"});n.addEventListener("show.bs.popover",(()=>{var e;return null==(e=r())?void 0:e.hide()})),n.addEventListener("shown.bs.popover",(()=>{let a="target"+t.random(),n=e(s._getTipElement());n.find(".popover-body").empty().html(t.PREVIEW_TEMPLATE),n.find(".nav-tabs, .nav-pills, .nav-underline").append(d.find(".nav-item").clone(!0)),n.find(".tab-pane").attr("id",a),n.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+a,"aria-controls":a}).first().tab("show")})),"click"!=t.PREVIEW_POPOVER_TRIGGER&&n.addEventListener(t.PREVIEW_POPOVER_TRIGGER,(function(){var e;this.getAttribute("aria-describedby")||null==(e=bootstrap.Popover.getInstance(this))||e.show()}))},d=function(e,a){var n;null==(n=bootstrap.Tooltip.getInstance(a))||n.dispose(),(a=a.closest(t.PREVIEW_SELECTOR))&&(a.classList.contains("ew-preview-btn")||a.classList.add("ew-preview-btn"),a.addEventListener("click",(()=>{t.PREVIEW_MODAL_DIALOG.attr("data-parent-id",this.closest("[id^=el]").id).modal("hide"),t.PREVIEW_MODAL_DIALOG.modal("show")})))},s=function(e,a){var n;null==(n=bootstrap.Tooltip.getInstance(a))||n.dispose(),(a=a.closest(t.PREVIEW_SELECTOR))&&(a.classList.contains("ew-preview-btn")||a.classList.add("ew-preview-btn"),a.addEventListener("click",(()=>{t.PREVIEW_OFFCANVAS_SIDEBAR.attr("data-parent-id",this.closest("[id^=el]").id).offcanvas("hide"),t.PREVIEW_OFFCANVAS_SIDEBAR.offcanvas("show")})))},i=function(n){let o=n.currentTarget,d=o.dataset.bsTarget||o.closest(".tab-pane");if(!d)return;let s=e(o),l=e(d),{url:c,page:p,table:v,sort:w,sortOrder:b,sortType:E}=o.dataset,f=new URLSearchParams,u=l.data(v)||{};c?(u.url=c,w=u.sort,b=u.sortOrder,p?(s.tooltip("hide"),u.page=p,l.data(v,u).find(".card.ew-grid").append(t.overlayTemplate())):(p=u.page||1,l.data(v,u).empty().html(t.PREVIEW_LOADING_HTML))):w&&(c=u.url,w!==u.sort||b!==u.sortOrder?u.page=p=1:p=u.page,u.sort=w,u.sortOrder=b,l.data(v,u).find(".card.ew-grid").append(t.overlayTemplate())),e.isNumber(p)&&f.set(t.TABLE_PAGE_NUMBER,p),w&&(f.set(t.TABLE_SORT,w),["ASC","DESC","NO"].includes(b)&&f.set("sortorder",b),n.shiftKey&&!n.ctrlKey?f.set("cmd","resetsort"):2==E&&n.ctrlKey&&f.set("ctrl","1")),t.fetch(c+"&"+f.toString()).then((async n=>{var o;if(null!=(o=n.headers.get("Content-Type"))&&o.includes("json")){let e=await n.json(),a=t.getError(e);if(a)return void t.alert(a)}else{let t=await n.text();l.empty().html(t);let o=".ew-detail-btn-group[data-table='"+v+"'][data-url='"+c.replace(/&detailfilters=.+/,"")+"']",r=l.closest(".ew-preview-nav").find(o);if(r[0]||(r=e("body").children(o)),r.is("div"))l.append(r.removeClass("d-none"));else if(r.is("ul")){let e=s.closest(".nav-item").addClass("dropdown"),t=e.find(".dropdown-toggle").addClass("active").removeClass("d-none");t[0]||(t=s.clone(),t.addClass("dropdown-toggle").attr({"data-bs-toggle":"dropdown","data-bs-target":null,role:"button"}),e.prepend(t),s.on("hide.bs.tab",(()=>{e.removeClass("dropdown").find(s).removeClass("d-none active"),e.find(".dropdown-toggle").addClass("d-none").removeClass("active show")}))),s.addClass("d-none")}l.find(".ew-pager .btn:not(.disabled), .ew-table-header > th > div[data-sort]").data({target:d,table:v}).on("click",i);let p=l.closest(".ew-preview-nav").find(".nav-link");l.find(".ew-detail-count.d-none[data-table][data-count]").each((function(){p.filter("[data-table='"+this.dataset.table+"']").find(".ew-detail-count-badge").attr("data-count",this.dataset.count).html(this.innerHTML)})),a.trigger(e.Event("preview.ew",{target:l[0],$tabpane:l}))}})).then((()=>{var e,t;null==(e=r())||e.update();let a=document.querySelector("#ew-preview-dialog");null!=a&&a.classList.contains("show")&&(null==(t=bootstrap.Modal.getInstance(a))||t.handleUpdate())}))},l=function(t){e(t.currentTarget.dataset.bsTarget).find(".dropdown-toggle[id]").dropdown("dispose");let a=t.currentTarget.closest(".popover, .modal, .nav");a&&e(a).find(".dropdown-toggle").dropdown("hide")},r=()=>{let e=document.querySelector(".ew-preview-popover.show");if(!e)return null;let t=document.querySelector(".ew-preview-btn[aria-describedby='"+e.id+"']");return t?bootstrap.Popover.getInstance(t):null};Object.assign(t,{showPreviewRow:n,detailPopover:o,detailModal:d,detailOffcanvas:s,showTab:i,hideTab:l,getActivePopover:r}),loadjs.ready("wrapper",(function(){document.addEventListener("click",(e=>{var t;e.target.closest(".ew-preview-popover")||null==(t=r())||t.hide()})),document.getElementById("ew-preview-dialog")||e("body").append(t.PREVIEW_MODAL_HTML),t.PREVIEW_MODAL_DIALOG=e("#ew-preview-dialog").modal(t.PREVIEW_MODAL_OPTIONS),e("#ew-preview-dialog").on("show.bs.modal",(function(){e(this).find(".modal-body").empty().html(t.PREVIEW_TEMPLATE)})).on("shown.bs.modal",(function(a){let n=e(this),o="target"+t.random();n.find(".nav-tabs, .nav-pills, .nav-underline").append(e("#"+this.dataset.parentId).find(".nav-item").clone(!0)),n.find(".tab-pane").attr("id",o),n.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+o,"aria-controls":o}).first().tab("show")})),document.getElementById("ew-preview-offcanvas")||e("body").append(t.PREVIEW_OFFCANVAS_HTML),t.PREVIEW_OFFCANVAS_SIDEBAR=e("#ew-preview-offcanvas").offcanvas(t.PREVIEW_OFFCANVAS_OPTIONS),e("#ew-preview-offcanvas").on("show.bs.offcanvas",(function(){e(this).find(".offcanvas-body").empty().html(t.PREVIEW_TEMPLATE)})).on("shown.bs.offcanvas",(function(){let a=e(this),n="target"+t.random();a.find(".nav-tabs, .nav-pills, .nav-underline").append(e("#"+this.dataset.parentId).find(".nav-item").clone(!0)),a.find(".tab-pane").attr("id",n),a.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+n,"aria-controls":n}).first().tab("show")}))}));let c=function(a){var r;let c=null!=(r=null==a?void 0:a.target)?r:document,p=e(c),v=c!==document,w=t.PREVIEW_TYPE;v||"row"==w?p.find("tr[data-rowindex][data-widget='expandable-table']").on("expand.lte.expandableTable",(e=>{var t;return!(null!=(t=Pace)&&t.running)||e.preventDefault()})).on("expanded.lte.expandableTable",n):"popover"==w?p.find(".ew-preview-btn").each(o):"modal"==w?p.find(".ew-preview-btn").each(d):"offcanvas"==w&&p.find(".ew-preview-btn").each(s),e("#ew-modal-dialog").off("success.ew.modal").on("success.ew.modal",((t,a)=>{e(null==a?void 0:a.navItem).trigger("show.bs.tab")})),p.find(".ew-preview [data-bs-toggle='tab']").on("show.bs.tab",i).on("hide.bs.tab",l)};e(c),e(".ew-multi-column-grid").on("load.ew",c),a.on("refresh.ew",c),a.on("preview.ew",(function(e){t.lazyLoad(e),t.initPanels(e.$tabpane[0]),e.$tabpane.find("table.ew-table").each(t.setupTable),t.initTooltips(e),t.initLightboxes(e),t.initIcons(e),c(e)}))}(jQuery,ew);
//# sourceMappingURL=preview.min.js.map